(function(){
  function h(html){const t=document.createElement('template');t.innerHTML=html.trim();return t.content.firstChild}
  function mount(){
    const root=document.getElementById('employment-quiz'); if(!root) return;
    root.innerHTML='';
    root.appendChild(h('<div class="wfq-container" style="max-width:800px;margin:0 auto;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif">\
      <div class="wfq-progress" style="width:100%;background:#e5e7eb;border-radius:12px;height:12px;margin-bottom:24px"><div id="wfq-progress-fill" style="background:linear-gradient(to right,#3b82f6,#1e40af);height:12px;border-radius:12px;transition:width .4s;width:12.5%"></div></div>\
      <div id="wfq-steps"></div>\
    </div>'));
    buildSteps(); attach(); updateProgress();
  }
  const state={step:1,total:8,answers:{},claims:[],salary:35000,timeline:null,amountOwed:0,start:Date.now()};
  function step(id,html){return `<div id="wfq-step-${id}" class="wfq-step" style="${id===1?'':'display:none;'}padding:24px;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1);margin-bottom:16px">${html}</div>`}
  function buildSteps(){
    const el=document.getElementById('wfq-steps');
    el.innerHTML=
      step(1,`
        <h1 style="font-size:2rem;font-weight:700;margin:0 0 8px;color:#111827;text-align:center">Could You Be Owed Workplace Compensation?</h1>
        <p style="color:#6b7280;text-align:center;margin:0 0 16px">Find out in under 5 minutes - thousands of employees are entitled to compensation</p>
        <div style="display:flex;flex-direction:column;gap:12px">
          ${btn('yes-believe','✅ Yes, I believe so')}
          ${btn('yes-definitely','✅ Yes, definitely')}
          ${btn('no-check','❌ No, but I want to check')}
          ${btn('not-sure','❌ I\'m not sure')}
        </div>
      `)+
      step(2,`
        <h2 style="font-size:1.5rem;font-weight:600;margin:0 0 16px;color:#111827">Tell Us About Your Employment</h2>
        <div style="display:flex;flex-direction:column;gap:20px">
          <div>
            <label style="display:block;font-weight:600;margin-bottom:8px">Current/Most Recent Annual Salary (before tax):</label>
            <input id="wfq-salary" type="range" min="15000" max="200000" value="35000" step="1000" style="width:100%">
            <div style="display:flex;justify-content:space-between;color:#6b7280;font-size:.9rem;margin-top:6px">
              <span>£15,000</span><span id="wfq-salary-display" style="color:#3b82f6;font-weight:600">£35,000</span><span>£200,000+</span>
            </div>
            <p style="color:#6b7280;font-size:.85rem;margin:6px 0 0">Include bonuses and benefits if applicable</p>
          </div>
          ${radioGroup('Employment Status',['still-employed','resigned','dismissed','redundant'],['Still employed at the same company','Left the company (resigned)','Was dismissed/let go','Made redundant'])}
          ${radioGroup('How long were/have you been employed there?',['less-2-years','2-5-years','5-10-years','more-10-years'],['Less than 2 years','2-5 years','5-10 years','More than 10 years'])}
          ${radioGroup('Company Size',['small','medium','large'],['Small (under 50 employees)','Medium (50-250 employees)','Large (250+ employees)'])}
        </div>
      `)+
      step(3,`
        <h2 style="font-size:1.5rem;font-weight:600;margin:0 0 8px;color:#111827">What Type of Treatment Did You Experience?</h2>
        <p style="color:#6b7280;margin:0 0 16px">Select all that apply - most workplace issues fall into multiple categories</p>
        <div id="wfq-claims" style="display:flex;flex-direction:column;gap:10px"></div>
        <div style="margin-top:16px;display:flex;justify-content:space-between;gap:8px">
          <button id="wfq-back-3" style="background:#e5e7eb;color:#111827;font-weight:600;padding:12px 16px;border-radius:8px;border:none">← Back</button>
          <button id="wfq-next-3" disabled style="opacity:.5;cursor:not-allowed;background:#3b82f6;color:#fff;font-weight:600;padding:12px 16px;border-radius:8px;border:none">Continue →</button>
        </div>
      `)+
      step(4,`
        <h2 style="font-size:1.5rem;font-weight:600;margin:0 0 8px;color:#111827">When Did This Happen?</h2>
        <div style="display:flex;flex-direction:column;gap:10px">
          ${btn('within-3-months','✅ Within the last 3 months (Within time limit)')}
          ${btn('3-6-months','⚠️ 3-6 months ago (Potentially within extended time limit)')}
          ${btn('6-12-months','❌ 6-12 months ago (May be out of time - urgent advice needed)')}
          ${btn('more-12-months','❌ More than 12 months ago (Likely out of time - exceptional circumstances only)')}
        </div>
        <div id="wfq-time-warn" style="display:none;margin-top:12px;padding:12px;border:1px solid #fef3c7;background:#fffbeb;border-radius:8px;color:#92400e">⚠️ Time limits may apply to your claim - urgent legal advice is recommended</div>
        <div style="margin-top:16px;display:flex;justify-content:space-between;gap:8px">
          <button id="wfq-back-4" style="background:#e5e7eb;color:#111827;font-weight:600;padding:12px 16px;border-radius:8px;border:none">← Back</button>
        </div>
      `)+
      step(5,`
        <h2 style="font-size:1.5rem;font-weight:600;margin:0 0 8px;color:#111827">Tell Us More About Your Situation</h2>
        <div id="wfq-conditional" style="display:flex;flex-direction:column;gap:16px"></div>
        <div style="margin-top:16px;display:flex;justify-content:space-between;gap:8px">
          <button id="wfq-back-5" style="background:#e5e7eb;color:#111827;font-weight:600;padding:12px 16px;border-radius:8px;border:none">← Back</button>
          <button id="wfq-next-5" style="background:#3b82f6;color:#fff;font-weight:600;padding:12px 16px;border-radius:8px;border:none">Continue →</button>
        </div>
      `)+
      step(6,`<h2 style="font-size:1.5rem;font-weight:600;margin:0 0 8px;color:#111827">Additional Details</h2><p style="color:#6b7280">More follow-ups if applicable.</p>
        <div style="margin-top:16px;display:flex;justify-content:space-between;gap:8px">
          <button id="wfq-back-6" style="background:#e5e7eb;color:#111827;font-weight:600;padding:12px 16px;border-radius:8px;border:none">← Back</button>
          <button id="wfq-next-6" style="background:#3b82f6;color:#fff;font-weight:600;padding:12px 16px;border-radius:8px;border:none">Continue →</button>
        </div>
      `)+
      step(7,`
        <h2 style="font-size:1.5rem;font-weight:600;margin:0 0 8px;color:#111827">Assessing Your Case Strength</h2>
        <div style="display:flex;flex-direction:column;gap:16px">
          ${checkboxGroup('Do you have any written evidence?',[
            ['emails','Emails discussing the issue'],['texts','Text messages/WhatsApp'],['policies','Company policies that were breached'],['reviews','Performance reviews/disciplinary letters'],['medical','Medical certificates/fit notes'],['none','No written evidence']
          ])}
          ${buttonGroup('Are there any witnesses to what happened?',['yes-supportive','yes-reluctant','no-witnesses','not-applicable'])}
          ${buttonGroup('Did you raise a formal complaint/grievance?',['yes-formal','yes-informal','wanted-to','didnt-know'])}
          ${buttonGroup('How would you rate the impact on you?',['severe','moderate','minor','uncertain'])}
        </div>
        <div style="margin-top:16px;display:flex;justify-content:space-between;gap:8px">
          <button id="wfq-back-7" style="background:#e5e7eb;color:#111827;font-weight:600;padding:12px 16px;border-radius:8px;border:none">← Back</button>
          <button id="wfq-next-7" style="background:#3b82f6;color:#fff;font-weight:600;padding:12px 16px;border-radius:8px;border:none">Continue →</button>
        </div>
      `)+
      step(8,`
        <h2 style="font-size:1.5rem;font-weight:600;margin:0 0 8px;color:#111827">Get Your Compensation Estimate</h2>
        <p style="color:#6b7280;margin:0 0 16px">Enter your details to see what your claim could be worth</p>
        <div style="margin:0 0 8px"><button id="wfq-back-8" style="background:#e5e7eb;color:#111827;font-weight:600;padding:10px 14px;border-radius:8px;border:none">← Back</button></div>
        <form id="wfq-form" style="display:flex;flex-direction:column;gap:12px">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px"><div><label style="font-weight:600;display:block;margin-bottom:6px">First Name *</label><input id="wfq-fn" required style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:8px"></div><div><label style="font-weight:600;display:block;margin-bottom:6px">Last Name *</label><input id="wfq-ln" required style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:8px"></div></div>
          <div><label style="font-weight:600;display:block;margin-bottom:6px">Email Address *</label><input id="wfq-email" type="email" required style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:8px"></div>
          <div><label style="font-weight:600;display:block;margin-bottom:6px">Mobile Number *</label><input id="wfq-phone" type="tel" required placeholder="+44 7xxx xxx xxx" pattern="^(\\+44\\s?7\\d{3}\\s?\\d{3}\\s?\\d{3}|07\\d{3}\\s?\\d{3}\\s?\\d{3})$" style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:8px"></div>
          <div><label style="font-weight:600;display:block;margin-bottom:6px">Best time to contact</label><select id="wfq-contact" style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:8px"><option value="morning">Morning</option><option value="afternoon">Afternoon</option><option value="evening">Evening</option></select></div>
          <label style="display:flex;gap:8px;align-items:flex-start"><input id="wfq-consent" type="checkbox" required><span style="font-size:.9rem;color:#374151">I consent to being contacted about my potential employment claim and receiving relevant legal information. I understand I can unsubscribe at any time. *</span></label>
          <label style="display:flex;gap:8px;align-items:flex-start"><input id="wfq-consent-opt" type="checkbox"><span style="font-size:.9rem;color:#374151">I'd like to receive helpful employment law updates and guides</span></label>
          <button type="submit" style="width:100%;background:#3b82f6;color:#fff;font-weight:600;padding:14px;border-radius:8px">Calculate My Compensation →</button>
        </form>
      `)+
      step('results',`
        <div id="wfq-results"></div>
        <div style="margin-top:16px"><h3 style="font-size:1.25rem;font-weight:600;margin:0 0 8px">Next Steps</h3><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px"><a id="wfq-book" href="#" style="display:block;text-align:center;background:#3b82f6;color:#fff;font-weight:600;padding:12px;border-radius:8px;text-decoration:none">Book Free Consultation</a><a href="https://wa.me/44XXXXXXXXXX" style="display:block;text-align:center;border:2px solid #3b82f6;color:#3b82f6;font-weight:600;padding:12px;border-radius:8px;text-decoration:none">WhatsApp Us</a></div></div>
        <div style="margin-top:16px;padding:16px;background:#f8fafc;border:1px solid #e5e7eb;border-radius:8px"><h4 style="font-weight:600;margin:0 0 8px">Legal Disclaimer</h4><p style="font-size:.9rem;color:#6b7280;margin:0 0 6px">The estimate provided is for guidance only and does not constitute legal advice. Actual compensation may vary based on individual circumstances. All communications are confidential and subject to legal professional privilege where applicable.</p><p style="font-size:.9rem;color:#6b7280;margin:0">This assessment is based on current UK employment law and tribunal statistics. Time limits apply to most employment claims. For accurate legal advice specific to your situation, please book a consultation with one of our qualified employment lawyers.</p></div>
      `);
    renderClaimBoxes();
  }
  function btn(val,label){return `<button class="wfq-btn" data-val="${val}" style="width:100%;padding:14px;border-radius:8px;border:2px solid #e5e7eb;background:#fff;text-align:left">${label}</button>`}
  function radioGroup(title,vals,labels){return `<div><label style="display:block;font-weight:600;margin-bottom:8px">${title}</label><div style="display:flex;flex-direction:column;gap:10px">${vals.map((v,i)=>btn(v,labels[i])).join('')}</div></div>`}
  function checkboxGroup(title,items){return `<div><label style=\"display:block;font-weight:600;margin-bottom:8px\">${title}</label><div style=\"display:flex;flex-direction:column;gap:8px\">${items.map(([v,l])=>`<label class=\"wfq-btn\" style=\"padding:12px;border:2px solid #e5e7eb;border-radius:8px;background:#fff;display:flex;gap:8px;align-items:flex-start\"><input type=\"checkbox\" data-ev=\"${v}\"> <span>${l}</span></label>`).join('')}</div></div>`}
  function buttonGroup(title,vals){const labelsMap={};vals.forEach(v=>labelsMap[v]=v.replace(/-/g,' '));return `<div><label style=\"display:block;font-weight:600;margin-bottom:8px\">${title}</label><div style=\"display:flex;flex-direction:column;gap:8px\">${vals.map(v=>btn(v,labelsMap[v].replace(/\b\w/g,m=>m.toUpperCase()))).join('')}</div></div>`}
  function renderClaimBoxes(){
    const claims=[
      ['unfair-dismissal','Unfair dismissal - Dismissed without proper process or fair reason'],
      ['pay-claims','Pay claims and disputes - Unpaid wages, holiday pay, overtime, bonuses'],
      ['sex-discrimination','Sex and gender discrimination - Treated unfairly due to gender/sex'],
      ['constructive-dismissal','Constructive dismissal - Forced to resign due to employer conduct'],
      ['disability-discrimination','Disability discrimination - Treated unfairly due to disability/health'],
      ['race-discrimination','Race and ethnicity discrimination - Treated unfairly due to race/ethnicity'],
      ['age-discrimination','Age discrimination - Treated unfairly due to your age'],
      ['sexual-harassment','Sexual harassment - Unwanted sexual conduct or comments'],
      ['maternity-discrimination','Maternity discrimination - Unfair treatment related to pregnancy/maternity'],
      ['sexual-orientation-discrimination','Sexual orientation discrimination - Treated unfairly due to sexual orientation'],
      ['workplace-bullying','Workplace bullying - Persistent intimidation or hostile behavior'],
      ['whistleblowing','Whistleblowing - Retaliation for reporting wrongdoing']
    ];
    const c=document.getElementById('wfq-claims');
    c.innerHTML=claims.map(([v,l])=>`<label class="wfq-claim" data-claim="${v}" style="padding:12px;border:2px solid #e5e7eb;border-radius:8px;background:#fff;display:flex;gap:10px;align-items:flex-start"><input type="checkbox" data-claim="${v}"><span>${l}</span></label>`).join('');
  }
  function attach(){
    document.addEventListener('input',function(e){
      if(e.target && e.target.id==='wfq-salary'){
        state.salary=parseInt(e.target.value,10)||state.salary; document.getElementById('wfq-salary-display').textContent=`£${state.salary.toLocaleString()}`;
      }
    });
    document.addEventListener('change',function(e){ if(e.target && e.target.id==='amount-owed'){ state.amountOwed = Number(e.target.value)||0; }});
    document.addEventListener('click',function(e){
      const btn=e.target.closest('.wfq-btn');
      if(btn && btn.dataset && btn.dataset.val){
        e.preventDefault();
        const val=btn.dataset.val;
        if(state.step===3){
          // handled by checkboxes except single buttons; ignore
        } else {
          state.answers['step_'+state.step]=val;
          if(state.step===4){ state.timeline=val; document.getElementById('wfq-time-warn').style.display=(val==='6-12-months'||val==='more-12-months')?'block':'none'; }
        }
        next();
      }
      if(e.target && e.target.getAttribute && e.target.getAttribute('data-claim')){
        // claim click fall-through
      }
      // Back/Next nav handlers
      if(e.target && e.target.id){
        if(e.target.id==='wfq-back-3'||e.target.id==='wfq-back-4'||e.target.id==='wfq-back-5'||e.target.id==='wfq-back-6'||e.target.id==='wfq-back-7'||e.target.id==='wfq-back-8'){
          e.preventDefault(); prev(); return;
        }
        if(e.target.id==='wfq-next-5'){ e.preventDefault(); next(); return; }
        if(e.target.id==='wfq-next-6'){ e.preventDefault(); next(); return; }
        if(e.target.id==='wfq-next-7'){ e.preventDefault(); next(); return; }
      }
    });
    document.addEventListener('change',function(e){
      const cl=e.target.getAttribute && e.target.getAttribute('data-claim');
      if(cl){
        if(e.target.checked){ if(!state.claims.includes(cl)) state.claims.push(cl); }
        else { state.claims=state.claims.filter(x=>x!==cl); }
        const nextBtn=document.getElementById('wfq-next-3');
        if(nextBtn){
          if(state.claims.length>0){ nextBtn.disabled=false; nextBtn.style.opacity='1'; nextBtn.style.cursor='pointer'; }
          else { nextBtn.disabled=true; nextBtn.style.opacity='.5'; nextBtn.style.cursor='not-allowed'; }
        }
      }
    });
    document.addEventListener('click',function(e){
      const nxt=e.target && e.target.id==='wfq-next-3';
      if(nxt){ e.preventDefault(); if(state.claims.length>0){ next(); } }
    });
    const form=document.getElementById('wfq-form');
    document.addEventListener('submit',function(e){
      if(e.target===form){
        e.preventDefault();
        if(!document.getElementById('wfq-consent').checked) return;
        state.contact={
          firstName:document.getElementById('wfq-fn').value.trim(),
          lastName:document.getElementById('wfq-ln').value.trim(),
          email:document.getElementById('wfq-email').value.trim(),
          phone:document.getElementById('wfq-phone').value.trim(),
          best:document.getElementById('wfq-contact').value,
          consent:document.getElementById('wfq-consent').checked,
          consentOpt:document.getElementById('wfq-consent-opt').checked
        };
        showResults(calc());
      }
    });
  }
  function updateProgress(){ const pct=(state.step/state.total)*100; const f=document.getElementById('wfq-progress-fill'); if(f) f.style.width=pct+'%'; }
  function next(){
    const cur=document.getElementById('wfq-step-'+state.step); if(cur) cur.style.display='none';
    state.step++;
    if(state.step===5) renderConditional();
    if(state.step<=state.total){ const nx=document.getElementById('wfq-step-'+state.step); if(nx) nx.style.display='block'; updateProgress(); }
    else { const nx=document.getElementById('wfq-step-results'); if(nx) nx.style.display='block'; }
  }
  function prev(){
    const cur=document.getElementById('wfq-step-'+state.step); if(cur) cur.style.display='none';
    state.step=Math.max(1,state.step-1);
    const nx=document.getElementById('wfq-step-'+state.step); if(nx) nx.style.display='block'; updateProgress();
  }
  function renderConditional(){
    const c=document.getElementById('wfq-conditional'); if(!c) return; let html='';
    if(state.claims.includes('unfair-dismissal')) html+=sectionUnfairDismissal();
    if(state.claims.includes('pay-claims')) html+=sectionPayClaims();
    if(state.claims.includes('sex-discrimination')) html+=sectionSexDiscrimination();
    if(state.claims.includes('disability-discrimination')) html+=sectionDisabilityDiscrimination();
    if(state.claims.includes('race-discrimination')) html+=sectionRaceDiscrimination();
    if(state.claims.includes('age-discrimination')) html+=sectionAgeDiscrimination();
    if(state.claims.includes('constructive-dismissal')) html+=sectionConstructiveDismissal();
    if(state.claims.includes('sexual-harassment')) html+=sectionSexualHarassment();
    if(state.claims.includes('maternity-discrimination')) html+=sectionMaternityDiscrimination();
    if(state.claims.includes('sexual-orientation-discrimination')) html+=sectionOrientationDiscrimination();
    if(state.claims.includes('workplace-bullying')) html+=sectionWorkplaceBullying();
    if(state.claims.includes('whistleblowing')) html+=sectionWhistleblowing();
    c.innerHTML=html || '<p style="color:#6b7280">No specific follow-ups required. Continue.</p>';
  }
  function sectionUnfairDismissal(){return block('Unfair Dismissal Details',[
    cb('No reason given'),cb('Performance issues'),cb('Misconduct allegations'),cb('Redundancy (but others kept on)')
  ])+btns(['no-process','brief-process','some-process','not-sure'],['No investigation or meetings','Very brief/unfair process','Some process but felt unfair','Not sure about the process']);}
  function sectionPayClaims(){return block('Pay Claims Details',[
    cb('Unpaid wages/salary'),cb('Unpaid holiday pay'),cb('Unpaid overtime'),cb('Unpaid bonuses/commission'),cb('Incorrect final pay/deductions')
  ])+`<div style="margin-top:8px"><label style="display:block;font-weight:600;margin-bottom:6px">How much are you owed approximately?</label><input id="amount-owed" type="number" placeholder="£0" style="width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:8px"></div>`}
  function sectionSexDiscrimination(){return block('Sex/Gender Discrimination Details',[cb('Passed over for promotion'),cb('Paid less than male colleagues'),cb('Inappropriate comments about gender'),cb('Treated differently due to pregnancy/maternity'),cb('Excluded from opportunities')])}
  function sectionDisabilityDiscrimination(){return block('Disability Discrimination Details',[cb('Refused reasonable adjustments'),cb('Dismissed due to sickness/disability'),cb('Harassment about disability'),cb('Denied equal opportunities'),cb('Disciplined for disability-related absence')])}
  function sectionRaceDiscrimination(){return block('Race/Ethnicity Discrimination Details',[cb('Racial slurs or comments'),cb('Passed over for promotion'),cb('Different treatment from colleagues'),cb('Excluded from workplace activities'),cb('Disciplined more harshly than others')])}
  function sectionAgeDiscrimination(){return block('Age Discrimination Details',[cb('Comments about my age'),cb('Passed over for promotion due to age'),cb('Made redundant (younger staff kept)'),cb('Excluded from training/opportunities'),cb('Pressured to retire')])}
  function sectionConstructiveDismissal(){return block('Constructive Dismissal Details',[cb('Significant changes to role/responsibilities without agreement'),cb('Reduction in pay or benefits'),cb('Bullying or harassment by management'),cb('Breach of health and safety obligations'),cb('Failure to investigate grievances properly'),cb('Impossible working conditions or unrealistic demands')])}
  function sectionSexualHarassment(){return block('Sexual Harassment Details',[cb('Unwanted physical contact or touching'),cb('Sexual comments or jokes'),cb('Requests for sexual favors'),cb('Displaying sexual images or materials'),cb('Inappropriate sexual messages/emails'),cb('Creating a sexually hostile work environment')])}
  function sectionMaternityDiscrimination(){return block('Maternity Discrimination Details',[cb('Dismissed or made redundant during pregnancy/maternity'),cb('Denied promotion due to pregnancy/maternity plans'),cb('Role changed or responsibilities reduced'),cb('Refused flexible working or reasonable adjustments'),cb('Harassment about pregnancy/maternity leave'),cb('Different treatment upon return from maternity leave')])}
  function sectionOrientationDiscrimination(){return block('Sexual Orientation Discrimination Details',[cb('Offensive comments about sexual orientation'),cb('Excluded from workplace social activities'),cb('Passed over for promotion due to sexual orientation'),cb('Different treatment from colleagues'),cb('Harassment or bullying related to sexual orientation'),cb('Denied equal opportunities or benefits')])}
  function sectionWorkplaceBullying(){return block('Workplace Bullying Details',[cb('Verbal abuse, shouting, or aggressive behavior'),cb('Public humiliation or embarrassment'),cb('Excessive criticism or impossible targets'),cb('Exclusion from meetings or workplace activities'),cb('Spreading rumors or undermining reputation'),cb('Threats or intimidation')])}
  function sectionWhistleblowing(){return block('Whistleblowing Details',[cb('Dismissed or made redundant'),cb('Demoted or role changed'),cb('Excluded from meetings or decision-making'),cb('Colleagues turned against me'),cb('Investigation was inadequate or biased'),cb('Suffered harassment or victimization')])+block('What type of wrongdoing did you report?',[cb('Health and safety violations'),cb('Financial misconduct or fraud'),cb('Legal breaches or regulatory violations'),cb('Environmental damage or concerns'),cb('Cover-up of wrongdoing'),cb('Danger to public health or safety')])}
  function block(title,items){return `<div><h3 style="font-weight:700;margin:8px 0">${title}</h3><div style="display:flex;flex-direction:column;gap:6px">${items.join('')}</div></div>`}
  function cb(label){return `<label style="padding:10px;border:2px solid #e5e7eb;border-radius:8px;background:#fff;display:flex;gap:8px;align-items:flex-start"><input type="checkbox"> <span>${label}</span></label>`}
  function btns(vals,labels){return `<div style=\"margin-top:8px;display:flex;flex-direction:column;gap:8px\">${vals.map((v,i)=>btn(v,labels[i])).join('')}</div>`}
  function calc(){
    let min=0,max=0; const breakdown=[];
    // Unfair dismissal
    if(state.claims.includes('unfair-dismissal')){
      const weekly=state.salary/52; const years=mapYears(state.answers.step_2); const ageMult=1.5;
      const basic=Math.min(weekly*years*ageMult,17130); const compensatory=Math.min(weekly*52,115115);
      const a=Math.round(basic), b=Math.round(basic+compensatory); breakdown.push({type:'Unfair Dismissal',min:a,max:b}); min+=a; max+=b;
    }
    // Pay claims
    if(state.claims.includes('pay-claims')){
      const owed=Number(state.amountOwed||3000); const a=Math.max(owed,1000), b=Math.max(Math.round(owed*1.5),5000);
      breakdown.push({type:'Pay Claims',min:a,max:b}); min+=a; max+=b;
    }
    // Discrimination (Vento bands simplified)
    const discr=state.claims.filter(c=>['sex-discrimination','disability-discrimination','race-discrimination','age-discrimination','sexual-orientation-discrimination','maternity-discrimination'].includes(c));
    if(discr.length){ const a=1100*discr.length, b=33700*discr.length; breakdown.push({type:'Injury to Feelings',min:a,max:b}); min+=a; max+=b; }
    // Case strength
    const strength=score(); let mult=1.0; if(strength==='good') mult=0.7; if(strength==='weak') mult=0.4;
    if(state.timeline==='6-12-months'||state.timeline==='more-12-months') mult=Math.min(mult,0.5);
    min=Math.round(min*mult); max=Math.round(max*mult);
    return {min:Math.max(min,1000),max:Math.max(max,3000),strength,breakdown};
  }
  function score(){ let s=0; // simple evidence-based scoring placeholder
    // You can extend with specific captures from step 7 buttons if needed
    const v=state.answers.step_7; if(v==='yes-supportive') s+=25; else if(v==='yes-reluctant') s+=15; if(v==='yes-formal') s+=20; else if(v==='yes-informal') s+=10; if(v==='severe') s+=25; else if(v==='moderate') s+=15;
    if(s>=70) return 'strong'; if(s>=40) return 'good'; return 'weak'; }
  function showResults(est){
    const warn=(state.timeline==='6-12-months'||state.timeline==='more-12-months');
    const strengthText= est.strength==='strong'?'strong case with good evidence':(est.strength==='good'?'good case, additional evidence could strengthen your claim':'case requiring further investigation');
    const header= warn? '<div style="background:#fef2f2;border:1px solid #fecaca;color:#991b1b;padding:12px 16px;border-radius:8px;margin-bottom:12px">⚠️ URGENT: Time limits may apply. Immediate legal advice is essential.</div>':'';
    document.getElementById('wfq-steps').innerHTML = step('results',`
      ${header}
      <div style="background:linear-gradient(to bottom right,#f0fdf4,white,#f0fdf4);border:1px solid #bbf7d0;border-radius:8px;padding:24px">
        <h2 style="font-size:2rem;font-weight:700;color:#10b981;margin:0 0 8px">You Could Be Entitled To: £${est.min.toLocaleString()} - £${est.max.toLocaleString()}</h2>
        <p style="margin:0 0 8px">Based on your responses, you appear to have a ${strengthText}.</p>
        <div>${est.breakdown.map(b=>`<div style=\"display:flex;justify-content:space-between;padding:6px 0\"><span>${b.type}</span><span>£${b.min.toLocaleString()} - £${b.max.toLocaleString()}</span></div>`).join('')}</div>
      </div>
      <div style="margin-top:16px"><h3 style="font-size:1.25rem;font-weight:600;margin:0 0 8px">Next Steps</h3><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px"><a href="#" style="display:block;text-align:center;background:#3b82f6;color:#fff;font-weight:600;padding:12px;border-radius:8px;text-decoration:none">Book Free Consultation</a><a href="https://wa.me/44XXXXXXXXXX" style="display:block;text-align:center;border:2px solid #3b82f6;color:#3b82f6;font-weight:600;padding:12px;border-radius:8px;text-decoration:none">WhatsApp Us</a></div></div>
      <div style="margin-top:16px;padding:16px;background:#f8fafc;border:1px solid #e5e7eb;border-radius:8px"><h4 style="font-weight:600;margin:0 0 8px">Legal Disclaimer</h4><p style="font-size:.9rem;color:#6b7280;margin:0 0 6px">The estimate provided is for guidance only and does not constitute legal advice. Actual compensation may vary.</p><p style="font-size:.9rem;color:#6b7280;margin:0">Time limits apply to most employment claims.</p></div>
    `);
  }
  function mapYears(v){switch(v){case 'less-2-years':return 1;case '2-5-years':return 3.5;case '5-10-years':return 7.5;case 'more-10-years':return 12;default:return 2}}
  // bootstrap
  if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',mount);} else {mount();}
})();
